<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMI - PT Digital Market Indonesia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --navy-dark: #0f172a;
            --navy-light: #1e293b;
            --accent-blue: #3b82f6;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
            background-color: var(--navy-dark);
            color: #ffffff;
        }

        .glass-nav {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .product-card {
            transition: all 0.2s ease-out;
            background-color: var(--navy-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
            border-color: var(--accent-blue);
        }

        .cat-active {
            background: var(--accent-blue) !important;
            color: white !important;
            border-color: var(--accent-blue) !important;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        input, textarea, select {
            background-color: #334155 !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        input::placeholder, textarea::placeholder {
            color: #94a3b8 !important;
        }

        .product-input-field {
            background-color: #0f172a !important;
            border: 1px solid rgba(59, 130, 246, 0.3) !important;
            font-size: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0.75rem;
            width: 100%;
            outline: none;
        }
    </style>
</head>
<body class="text-white">

    <!-- Navbar -->
    <nav class="glass-nav fixed top-0 w-full z-50 border-b border-white/10">
        <div class="container mx-auto px-4 lg:px-8 h-16 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="setActiveCategory('All')">
                <div class="bg-blue-600 p-2 rounded-xl text-white shadow-lg">
                    <span class="font-black text-xs">DMI</span>
                </div>
                <div>
                    <h1 class="text-lg font-extrabold tracking-tight leading-none text-white">DMI<span class="text-blue-400">.ID</span></h1>
                    <p class="text-[7px] text-slate-400 font-bold uppercase tracking-[0.2em] mt-1">PT Digital Market Indonesia</p>
                </div>
            </div>
            
            <div class="flex items-center space-x-2">
                <button onclick="askAIAssistant()" class="p-2.5 bg-blue-900/30 border border-blue-500/30 rounded-xl text-blue-400 hover:bg-blue-600 hover:text-white transition-all">
                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                    <span class="text-[10px] font-bold uppercase hidden sm:inline">AI Assistant ✨</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <header class="relative pt-24 pb-12 lg:pt-32 lg:pb-20 bg-slate-900 overflow-hidden">
        <div class="container mx-auto px-4 relative z-10 text-center">
            <span class="inline-block px-4 py-1.5 bg-blue-900/40 text-blue-300 rounded-full text-[10px] font-bold uppercase tracking-widest mb-4 border border-blue-500/30">DMI Official Hub</span>
            <div id="ai-greeting" class="text-blue-300 text-[10px] mb-2 font-mono h-4 italic"></div>
            <h2 class="text-3xl lg:text-5xl font-extrabold text-white mb-4 leading-tight">Solusi <span class="text-blue-400">Digital & PPOB</span></h2>
            <p class="text-slate-400 text-sm lg:text-base mb-8 max-w-xl mx-auto">Platform terpercaya dari PT Digital Market Indonesia untuk segala kebutuhan digital Anda.</p>
            
            <div class="relative max-w-xl mx-auto group">
                <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none">
                    <i class="fas fa-search text-slate-400 group-focus-within:text-blue-400"></i>
                </div>
                <input type="text" id="searchInput" onkeyup="searchProduct()" placeholder="Cari layanan..." 
                    class="w-full pl-12 pr-4 py-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm">
            </div>
        </div>
    </header>

    <!-- Kategori -->
    <section class="sticky top-16 z-40 bg-slate-900/80 backdrop-blur-md border-b border-white/5">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-wrap justify-center gap-3 no-scrollbar" id="categoryTabs"></div>
        </div>
    </section>

    <!-- Produk -->
    <main class="container mx-auto px-4 py-8 min-h-[60vh]">
        <div id="categoryHeader" class="mb-6 text-center"></div>
        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 py-10 border-t border-white/5 text-center">
        <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">© 2026 PT Digital Market Indonesia</p>
    </footer>

    <!-- Modal Checkout -->
    <div id="checkoutModal" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
        <div class="bg-slate-800 rounded-[2rem] w-full max-w-lg p-8 max-h-[90vh] overflow-y-auto shadow-2xl border border-white/10">
            <h4 class="text-2xl font-extrabold text-center mb-2 text-white">Konfirmasi Pesanan</h4>
            <p id="checkoutItemName" class="text-center text-blue-400 font-bold mb-6 text-sm"></p>
            
            <div class="space-y-4">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Detail Pemesan</label>
                    <input type="text" id="custName" placeholder="Nama Lengkap" class="w-full p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Kode Agen <span class="text-[8px] normal-case opacity-50">(Khusus Agen)</span></label>
                        <input type="text" id="affiliateCode" onkeyup="calculateGrandTotal()" placeholder="MASUKKAN KODE" class="w-full p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 uppercase text-xs">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Kode STAR</label>
                        <input type="text" id="promoCode" onkeyup="calculateGrandTotal()" placeholder="STAR" class="w-full p-4 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 uppercase text-xs">
                    </div>
                </div>

                <div class="bg-slate-900 text-white p-6 rounded-2xl flex flex-col space-y-2 border border-white/5 mt-4">
                    <div class="flex justify-between items-center text-xs opacity-70 mb-1">
                        <span>Harga Produk</span>
                        <span id="basePriceText">Rp 0</span>
                    </div>
                    <div class="flex justify-between items-center text-xs opacity-70 mb-1">
                        <span>Biaya Layanan (20%)</span>
                        <span id="serviceFeeText">Rp 0</span>
                    </div>
                    <div id="affiliateContainer" class="hidden flex justify-between items-center text-xs text-green-400 font-bold mb-1">
                        <span id="affiliateLabel">Potongan Agen (10%)</span>
                        <span id="affiliateDiscountText">-Rp 0</span>
                    </div>
                    <div id="promoContainer" class="hidden flex justify-between items-center text-xs text-yellow-400 font-bold mb-1">
                        <span id="promoLabel">Promo STAR (5%)</span>
                        <span id="promoDiscountText">-Rp 0</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-white/10 mt-1">
                        <span class="text-sm font-medium">Total Bayar</span>
                        <span id="checkoutGrandTotal" class="text-xl font-bold text-blue-400">Rp 0</span>
                    </div>
                </div>
                
                <button onclick="processWhatsAppCheckout()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold flex items-center justify-center space-x-2 hover:bg-blue-700 transition-all shadow-lg">
                    <i class="fab fa-whatsapp text-lg"></i>
                    <span>Pesan via WhatsApp</span>
                </button>
                <button onclick="closeCheckoutModal()" class="w-full text-slate-400 py-2 text-sm font-bold hover:text-white transition-colors">Batal</button>
            </div>
        </div>
    </div>

    <!-- Modal AI Overlay -->
    <div id="aiModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
        <div class="bg-slate-900 border border-blue-500/30 rounded-3xl w-full max-w-lg overflow-hidden shadow-2xl">
            <div class="p-6 bg-blue-600 flex justify-between items-center">
                <h5 class="font-extrabold flex items-center"><i class="fas fa-wand-magic-sparkles mr-2"></i> DMI AI Assistant ✨</h5>
                <button onclick="closeAIModal()" class="text-white/70 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div id="ai-modal-content" class="p-8 text-sm leading-relaxed text-slate-300">
                Memproses rekomendasi terbaik untukmu...
            </div>
            <div class="p-6 bg-slate-800 border-t border-white/5 flex justify-end">
                <button onclick="closeAIModal()" class="px-6 py-2 bg-slate-700 rounded-xl text-xs font-bold uppercase tracking-wider">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        const WA_NUMBER = "6285881583885";
        const apiKey = ""; 
        
        // Konstanta Perhitungan Baru sesuai Instruksi
        const TOTAL_SERVICE_FEE_PERCENT = 0.20; // Biaya Layanan Dasar 20%
        const AFFILIATE_DISCOUNT_PERCENT = 0.10; // Potongan Agen 10%
        const PROMO_STAR_PERCENT = 0.05; // Potongan Kode STAR 5%
        
        const VALID_AFFILIATE_CODE = "DMISTAR02"; 
        const VALID_PROMO_STAR = "STAR"; 
        
        let products = [];
        let currentCategory = "All";
        let selectedProduct = null;

        // ================= GEMINI API HELPERS =================

        async function callGemini(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: "Anda adalah asisten cerdas untuk DMI (PT Digital Market Indonesia). Gunakan bahasa Indonesia yang ramah dan profesional." }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, AI sedang beristirahat.";
            } catch (e) { return "Koneksi terganggu."; }
        }

        async function initAIGreeting() {
            const greeting = await callGemini("Buat pesan sambutan sangat pendek untuk pelanggan DMI.");
            const element = document.getElementById('ai-greeting');
            if (element) element.innerText = greeting;
        }

        async function askAIAssistant() {
            const modal = document.getElementById('aiModal');
            const content = document.getElementById('ai-modal-content');
            modal.classList.remove('hidden');
            content.innerHTML = `<div class="flex flex-col items-center py-10"><i class="fas fa-spinner fa-spin text-3xl text-blue-500 mb-4"></i><p>Menganalisa...</p></div>`;
            const response = await callGemini("Berikan 3 alasan utama belanja di DMI (Digital Market Indonesia).");
            content.innerHTML = response.replace(/\n/g, '<br>');
        }

        function closeAIModal() { document.getElementById('aiModal').classList.add('hidden'); }

        // ================= CORE APP LOGIC =================

        function generateData() {
            const mlItems = [
                { id: 'ml-25', name: 'MLBB 25 Diamonds', price: 15000, category: 'TOP-UP', requiresGameId: true },
                { id: 'ml-50', name: 'MLBB 50 Diamonds', price: 30000, category: 'TOP-UP', requiresGameId: true },
                { id: 'ml-150', name: 'MLBB 150 Diamonds', price: 80000, category: 'TOP-UP', requiresGameId: true },
                { id: 'ml-220', name: 'MLBB 220 Diamonds', price: 90000, category: 'TOP-UP', requiresGameId: true },
                { id: 'ml-250', name: 'MLBB 250 Diamonds', price: 120000, category: 'TOP-UP', requiresGameId: true },
                { id: 'ml-350', name: 'MLBB 350 Diamonds', price: 180000, category: 'TOP-UP', requiresGameId: true },
                { id: 'ml-500', name: 'MLBB 500 Diamonds', price: 220000, category: 'TOP-UP', requiresGameId: true },
                { id: 'ml-750', name: 'MLBB 750 Diamonds', price: 350000, category: 'TOP-UP', requiresGameId: true }
            ];

            const plnItems = [
                { id: 'pln-50', name: 'Token PLN 50.000', price: 51000, category: 'Token Listrik' },
                { id: 'pln-100', name: 'Token PLN 100.000', price: 101000, category: 'Token Listrik' }
            ];

            const eWalletItems = [
                { id: 'ew-custom', name: 'Top Up E-Wallet', price: 0, category: 'E-Wallet', isCustom: true, wallets: ["DANA", "GoPay", "OVO", "LinkAja"] }
            ];

            const creatingItems = [
                { id: 'cr-npwp', name: 'Jasa NPWP Online', price: 50000, category: 'Creating' },
                { id: 'cr-prof', name: 'Company Profile', price: 200000, category: 'Creating' }
            ];

            const streamingApps = ["Netflix Premium", "YouTube Premium", "Disney+ Hotstar", "Viu Premium", "Spotify Premium"];
            const streams = [];
            streamingApps.forEach((app, index) => {
                streams.push({ id: `s-${index}-1m`, name: `${app} - 1 Bulan`, price: 35000, category: 'Streaming' });
                streams.push({ id: `s-${index}-3m`, name: `${app} - 3 Bulan`, price: 85000, category: 'Streaming' });
            });

            products = [...mlItems, ...plnItems, ...eWalletItems, ...creatingItems, ...streams];
        }

        function renderTabs() {
            const cats = ["All", ...new Set(products.map(p => p.category))];
            const container = document.getElementById('categoryTabs');
            container.innerHTML = cats.map(cat => `
                <button onclick="setActiveCategory('${cat}')" 
                    class="flex-none bg-slate-800 px-5 py-2 rounded-xl border border-white/5 font-bold text-xs transition-all uppercase tracking-wider ${cat === currentCategory ? 'cat-active' : 'text-slate-400 hover:text-white'}">
                    ${cat}
                </button>
            `).join('');
        }

        function setActiveCategory(cat) {
            currentCategory = cat;
            renderTabs();
            renderProducts();
        }

        function renderProducts(filtered = null) {
            const grid = document.getElementById('productGrid');
            const header = document.getElementById('categoryHeader');
            let list = filtered || (currentCategory === "All" ? products : products.filter(p => p.category === currentCategory));

            header.innerHTML = `<h3 class="text-xl font-bold text-white">${currentCategory}</h3>`;
            grid.innerHTML = list.map(p => {
                if(p.isCustom) {
                    return `
                    <div class="product-card rounded-2xl p-6 flex flex-col justify-between h-full border-blue-500/50 border-dashed">
                        <div>
                            <span class="text-[9px] uppercase tracking-widest text-blue-400 font-extrabold mb-3 block">${p.category}</span>
                            <h4 class="font-bold text-sm text-white leading-snug mb-4">${p.name}</h4>
                            <div class="space-y-3">
                                <select id="wallet-type" class="product-input-field">
                                    ${p.wallets.map(w => `<option value="${w}">${w}</option>`).join('')}
                                </select>
                                <input type="number" id="wallet-nominal" placeholder="Nominal (Rp)" class="product-input-field">
                            </div>
                        </div>
                        <div class="mt-8">
                            <button onclick="buyCustomWallet('${p.id}')" class="w-full bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700 transition-all text-xs font-bold uppercase shadow-sm">
                                Beli Sekarang ✨
                            </button>
                        </div>
                    </div>`;
                }

                if(p.requiresGameId) {
                    return `
                    <div class="product-card rounded-2xl p-6 flex flex-col justify-between h-full">
                        <div>
                            <span class="text-[9px] uppercase tracking-widest text-blue-400 font-extrabold mb-2 block">${p.category}</span>
                            <h4 class="font-bold text-sm text-white mb-1">${p.name}</h4>
                            <p class="text-blue-400 font-extrabold text-lg mb-4">Rp ${p.price.toLocaleString('id-ID')}</p>
                            <div class="space-y-2">
                                <input type="text" id="game-id-${p.id}" placeholder="ID Game" class="product-input-field">
                                <input type="text" id="game-code-${p.id}" placeholder="Server/Zona" class="product-input-field">
                            </div>
                        </div>
                        <div class="mt-6">
                            <button onclick="buyGame('${p.id}')" class="w-full bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700 transition-all text-xs font-bold uppercase">
                                Beli Sekarang
                            </button>
                        </div>
                    </div>`;
                }
                
                return `
                <div class="product-card rounded-2xl p-6 flex flex-col justify-between h-full">
                    <div>
                        <span class="text-[9px] uppercase tracking-widest text-blue-400 font-extrabold mb-3 block">${p.category}</span>
                        <h4 class="font-bold text-sm text-white mb-3">${p.name}</h4>
                        <p class="text-blue-400 font-extrabold text-xl">Rp ${p.price.toLocaleString('id-ID')}</p>
                    </div>
                    <div class="mt-8">
                        <button onclick="initCheckout('${p.id}')" class="w-full bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700 transition-all text-xs font-bold uppercase shadow-sm">
                            Beli Sekarang
                        </button>
                    </div>
                </div>`;
            }).join('');
        }

        function searchProduct() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            renderProducts(products.filter(p => p.name.toLowerCase().includes(q)));
        }

        // ================= CHECKOUT LOGIC =================

        function calculateGrandTotal() {
            if(!selectedProduct) return;
            
            const subtotal = selectedProduct.price;
            const totalServiceFee = subtotal * TOTAL_SERVICE_FEE_PERCENT;
            
            let affiliateDiscount = 0;
            let promoDiscount = 0;

            // Logika Potongan Agen 10%
            const affCode = document.getElementById('affiliateCode').value.toUpperCase().trim();
            if (affCode === VALID_AFFILIATE_CODE) {
                affiliateDiscount = subtotal * AFFILIATE_DISCOUNT_PERCENT;
                document.getElementById('affiliateContainer').classList.remove('hidden');
                document.getElementById('affiliateDiscountText').innerText = `-Rp ${Math.round(affiliateDiscount).toLocaleString('id-ID')}`;
            } else {
                document.getElementById('affiliateContainer').classList.add('hidden');
            }

            // Logika Potongan Kode STAR 5%
            const starCode = document.getElementById('promoCode').value.toUpperCase().trim();
            if (starCode === VALID_PROMO_STAR) {
                promoDiscount = subtotal * PROMO_STAR_PERCENT;
                document.getElementById('promoContainer').classList.remove('hidden');
                document.getElementById('promoDiscountText').innerText = `-Rp ${Math.round(promoDiscount).toLocaleString('id-ID')}`;
            } else {
                document.getElementById('promoContainer').classList.add('hidden');
            }

            const grand = subtotal + totalServiceFee - affiliateDiscount - promoDiscount;
            
            document.getElementById('basePriceText').innerText = `Rp ${subtotal.toLocaleString('id-ID')}`;
            document.getElementById('serviceFeeText').innerText = `Rp ${Math.round(totalServiceFee).toLocaleString('id-ID')}`;
            document.getElementById('checkoutGrandTotal').innerText = `Rp ${Math.max(0, Math.round(grand)).toLocaleString('id-ID')}`;
            
            return { grand, subtotal, totalServiceFee, affiliateDiscount, promoDiscount };
        }

        function initCheckout(id) {
            selectedProduct = products.find(x => x.id === id);
            openCheckoutModal();
        }

        function buyGame(id) {
            const gId = document.getElementById(`game-id-${id}`).value;
            const gCode = document.getElementById(`game-code-${id}`).value;
            if(!gId || !gCode) return alert('Mohon isi ID Game & Server!');
            
            const base = products.find(x => x.id === id);
            selectedProduct = { ...base, gameData: { id: gId, code: gCode } };
            openCheckoutModal();
        }

        function buyCustomWallet(id) {
            const type = document.getElementById('wallet-type').value;
            const nominal = parseInt(document.getElementById('wallet-nominal').value);
            if(!nominal || nominal < 10000) return alert('Minimal top up Rp 10.000');
            
            selectedProduct = { id: 'custom-ew', name: `Top Up ${type}`, price: nominal, category: 'E-Wallet' };
            openCheckoutModal();
        }

        function openCheckoutModal() {
            document.getElementById('checkoutItemName').innerText = selectedProduct.name;
            calculateGrandTotal();
            document.getElementById('checkoutModal').classList.remove('hidden');
        }

        function closeCheckoutModal() { 
            document.getElementById('checkoutModal').classList.add('hidden'); 
            selectedProduct = null;
        }

        function processWhatsAppCheckout() {
            const name = document.getElementById('custName').value;
            if(!name) return alert('Silakan isi nama Anda!');
            
            const calc = calculateGrandTotal();
            const affCode = document.getElementById('affiliateCode').value.toUpperCase().trim();

            let msg = `*PESANAN DMI (DIGITAL MARKET INDONESIA)*\n` +
                      `Pelanggan: ${name}\n` +
                      `Produk: ${selectedProduct.name}\n`;
            
            if(selectedProduct.gameData) {
                msg += `ID Game: ${selectedProduct.gameData.id}\nServer/Zona: ${selectedProduct.gameData.code}\n`;
            }

            msg += `----------------------------\n` +
                   `Harga Produk: Rp ${calc.subtotal.toLocaleString('id-ID')}\n` +
                   `Biaya Layanan (20%): Rp ${Math.round(calc.totalServiceFee).toLocaleString('id-ID')}\n`;
            
            if (calc.affiliateDiscount > 0) {
                msg += `Potongan Agen: -Rp ${Math.round(calc.affiliateDiscount).toLocaleString('id-ID')}\n`;
            }
            if (calc.promoDiscount > 0) {
                msg += `Promo STAR (5%): -Rp ${Math.round(calc.promoDiscount).toLocaleString('id-ID')}\n`;
            }

            msg += `\n*TOTAL BAYAR: Rp ${Math.max(0, Math.round(calc.grand)).toLocaleString('id-ID')}*`;
            window.open(`https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(msg)}`);
        }

        window.onload = () => { 
            generateData(); 
            renderTabs(); 
            renderProducts(); 
            initAIGreeting();
        };
    </script>
</body>
</html>